<Window
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:dd="urn:gong-wpf-dragdrop"
        xmlns:av="http://schemas.microsoft.com/expression/blend/2008" 
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        mc:Ignorable="av" 
        x:Class="Bokhandel_Labb.Views.BokbyteView"
        WindowStartupLocation="CenterOwner"
        Title="Inventering" 
        Height="850"
        FontFamily="Bahnschrift SemiLight"
        Background="#FF2F4F4F"
        dd:DragDrop.DefaultDragAdornerOpacity="1"
        Width="1200">

    <!-- Commands för kortkommandon -->
    <Window.InputBindings>
        <KeyBinding Key="S" Modifiers="Control" Command="{Binding SparaÄndringarCommand}"/>
        <KeyBinding Key="Z" Modifiers="Control" Command="{Binding ÅterställCommand}"/>
        <KeyBinding Key="E" Command="{Binding ÄndraLagersaldoCommand}"/>
        <KeyBinding Key="F1" Command="{Binding HjälpCommand}"/>
        <KeyBinding Key="Q" Modifiers="Alt" Command="{Binding CancelCommand}"/>
    </Window.InputBindings>

    <!-- Styles för kontroller -->
    <Window.Resources>
        <!-- Style för Menu -->
        <Style TargetType="Menu">
            <Setter Property="Background" Value="#FF1A3333"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- Style för MenuItem -->
        <Style TargetType="MenuItem">
            <Setter Property="Background" Value="#FF1A3333"/>
            <Setter Property="Foreground" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="#FF0D1F1F"/>
                </Trigger>
                <Trigger Property="IsSubmenuOpen" Value="True">
                    <Setter Property="Background" Value="#FF0D1F1F"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style för böcker -->
        <Style x:Key="BookItemStyle" TargetType="{x:Type ListBoxItem}">
            <Setter Property="Margin" Value="2,1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E3F2FD"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#BBDEFB"/>
                    <Setter Property="BorderBrush" Value="#2196F3"/>
                    <Setter Property="BorderThickness" Value="2,0,2,1"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- DataTemplate för böcker -->
        <DataTemplate x:Key="LagerSaldoTemplate">
            <Border Background="#F5F5F5" 
                    CornerRadius="3" 
                    Padding="8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="{Binding Titel}" 
                                   FontWeight="SemiBold" 
                                   FontSize="13"
                                   Foreground="#1A237E"
                                   TextTrimming="CharacterEllipsis"/>
                        <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                            <TextBlock Text="{Binding FörfattareNamn}" 
                                       FontSize="11" 
                                       Foreground="#424242"
                                       TextTrimming="CharacterEllipsis"
                                       MaxWidth="200"/>
                            <TextBlock Text=" • " 
                                       FontSize="11" 
                                       Foreground="#9E9E9E"
                                       Margin="3,0"/>
                            <TextBlock Text="{Binding Isbn}" 
                                       FontSize="10" 
                                       Foreground="#757575"/>
                        </StackPanel>
                    </StackPanel>

                    <Border Grid.Column="1"
                            Background="#E8F5E9"
                            CornerRadius="3"
                            Padding="10,4"
                            Margin="8,0,0,0"
                            VerticalAlignment="Center">
                        <TextBlock Text="{Binding AntalILager, StringFormat={}{0} st}"
                                   FontSize="11"
                                   FontWeight="Bold"
                                   Foreground="#2E7D32"/>
                    </Border>
                </Grid>
            </Border>
        </DataTemplate>

        <!-- Button Style med IsPressed feedback -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="ButtonBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="5"
                                Padding="{TemplateBinding Padding}">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="5" 
                                                ShadowDepth="2" 
                                                Opacity="0.3"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="ButtonBorder" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="ButtonBorder" Property="RenderTransformOrigin" Value="0.5,0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <!-- Topmenu (före banner) -->
        <Menu VerticalAlignment="Top"
              Panel.ZIndex="2"
              FontFamily="Bahnschrift SemiLight"
              FontSize="13">
            <MenuItem Header="_Arkiv">
                <MenuItem Header="_Spara Ändringar" 
                          Command="{Binding SparaÄndringarCommand}"
                          InputGestureText="Ctrl+S">
                    <MenuItem.Icon>
                        <TextBlock Text="💾" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Å_terställ" 
                          Command="{Binding ÅterställCommand}"
                          InputGestureText="Ctrl+Z">
                    <MenuItem.Icon>
                        <TextBlock Text="↶" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator Background="#FF0D1F1F"/>
                <MenuItem Header="A_vsluta" 
                          Command="{Binding CancelCommand}"
                          InputGestureText="Alt+Q">
                    <MenuItem.Icon>
                        <TextBlock Text="✖" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>

            <MenuItem Header="_Redigera">
                <MenuItem Header="Ändra _lagersaldo" 
                          Command="{Binding ÄndraLagersaldoCommand}"
                          InputGestureText="E">
                    <MenuItem.Icon>
                        <TextBlock Text="📝" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>

            <MenuItem Header="_Hjälp">
                <MenuItem Header="_Hjälp" 
                          Command="{Binding HjälpCommand}"
                          InputGestureText="F1">
                    <MenuItem.Icon>
                        <TextBlock Text="❓" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>

        <!-- Header Band (efter meny) -->
        <Border Background="#FF1A3333" 
                Height="70" 
                VerticalAlignment="Top"
                Margin="0,24,0,0"
                Panel.ZIndex="1">
            <Grid Margin="20,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Titel -->
                <TextBlock Grid.Column="0"
                           Text="📦 Inventering" 
                           FontSize="26" 
                           FontWeight="Bold"
                           Foreground="White"
                           VerticalAlignment="Center"/>

                <!-- Sökruta -->
                <Border Grid.Column="2"
                        Background="White"
                        CornerRadius="20"
                        Padding="12,8"
                        MinWidth="300"
                        VerticalAlignment="Center">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                                   Text="🔍"
                                   FontSize="16"
                                   Margin="0,0,8,0"
                                   VerticalAlignment="Center"/>

                        <TextBox Grid.Column="1"
                                 Text="{Binding SökText, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="13"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 VerticalAlignment="Center"
                                 Foreground="#424242">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Style.Triggers>
                                        <Trigger Property="Text" Value="">
                                            <Setter Property="Background">
                                                <Setter.Value>
                                                    <VisualBrush Stretch="None" AlignmentX="Left">
                                                        <VisualBrush.Visual>
                                                            <TextBlock Text="Sök efter bok..." 
                                                                       Foreground="#999999" 
                                                                       FontSize="13"/>
                                                        </VisualBrush.Visual>
                                                    </VisualBrush>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Margin="20,104,20,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Butik Val -->
            <Grid Grid.Row="0" Margin="0,0,0,15">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="60"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Vänster butik -->
                <Border Grid.Column="0"
                        Background="#FF3A5A5A"
                        CornerRadius="6"
                        Padding="12">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="6" 
                                        ShadowDepth="2" 
                                        Opacity="0.3"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="📍 Butik A" 
                                   FontWeight="SemiBold" 
                                   FontSize="13"
                                   Margin="0,0,0,6" 
                                   Foreground="White"/>
                        <ComboBox ItemsSource="{Binding TillgängligaButiker1}"
                                  SelectedItem="{Binding ValdButik1}"
                                  DisplayMemberPath="ButiksNamn"
                                  Padding="8"
                                  FontSize="12"
                                  Background="White"/>
                    </StackPanel>
                </Border>

                <!-- Mittenpil -->
                <StackPanel Grid.Column="1" 
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center">
                    <Border Background="#FF1A3333"
                            CornerRadius="18"
                            Width="36"
                            Height="36">
                        <TextBlock Text="⇄" 
                                   FontSize="20" 
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Foreground="White"/>
                    </Border>
                </StackPanel>

                <!-- Höger butik -->
                <Border Grid.Column="2"
                        Background="#FF3A5A5A"
                        CornerRadius="6"
                        Padding="12">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="6" 
                                        ShadowDepth="2" 
                                        Opacity="0.3"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="📍 Butik B" 
                                   FontWeight="SemiBold" 
                                   FontSize="13"
                                   Margin="0,0,0,6" 
                                   Foreground="White"/>
                        <ComboBox ItemsSource="{Binding TillgängligaButiker2}"
                                  SelectedItem="{Binding ValdButik2}"
                                  DisplayMemberPath="ButiksNamn"
                                  Padding="8"
                                  FontSize="12"
                                  Background="White"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Butiker och böcker -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Butik 1 Lager -->
                <Border Grid.Column="0" 
                        Background="#FF3A5A5A"
                        BorderBrush="#FF5A7A7A" 
                        BorderThickness="1" 
                        CornerRadius="6"
                        Padding="0">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="8" 
                                        ShadowDepth="3" 
                                        Opacity="0.3"/>
                    </Border.Effect>
                    <DockPanel>
                        <!-- Header -->
                        <Border DockPanel.Dock="Top" 
                                Background="#FF1A3333"
                                CornerRadius="6,6,0,0"
                                Padding="12,10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding ValdButik1.ButiksNamn}" 
                                               FontSize="15" 
                                               FontWeight="Bold"
                                               Foreground="White"/>
                                    <TextBlock Text="{Binding ValdButik1.Adress}" 
                                               FontSize="11" 
                                               Foreground="#B0C4C4"
                                               Margin="0,2,0,0"/>
                                </StackPanel>
                                <Border Grid.Column="1"
                                        Background="#4D81C784"
                                        CornerRadius="3"
                                        Padding="8,4"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Butik1Böcker.Count, StringFormat={}{0} böcker}" 
                                               FontSize="11" 
                                               FontWeight="SemiBold"
                                               Foreground="White"/>
                                </Border>
                            </Grid>
                        </Border>

                        <!-- Butik 1 ListBox -->
                        <ListBox ItemsSource="{Binding Butik1Böcker}"
                                 ItemTemplate="{StaticResource LagerSaldoTemplate}"
                                 ItemContainerStyle="{StaticResource BookItemStyle}"
                                 dd:DragDrop.IsDragSource="True"
                                 dd:DragDrop.IsDropTarget="True"
                                 dd:DragDrop.DropHandler="{Binding DropHandler}"
                                 dd:DragDrop.UseDefaultDragAdorner="True"
                                 dd:DragDrop.DefaultDragAdornerOpacity="0.8"
                                 BorderThickness="0"
                                 Background="White"
                                 SelectedItem="{Binding ValdBok}"
                                 Tag="Butik1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 ScrollViewer.CanContentScroll="False"/>
                        
                    </DockPanel>
                </Border>

                <!-- Butik 2 Lager -->
                <Border Grid.Column="2" 
                        Background="#FF3A5A5A"
                        BorderBrush="#FF5A7A7A" 
                        BorderThickness="1" 
                        CornerRadius="6"
                        Padding="0">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="8" 
                                        ShadowDepth="3" 
                                        Opacity="0.3"/>
                    </Border.Effect>
                    <DockPanel>
                        <!-- Header -->
                        <Border DockPanel.Dock="Top" 
                                Background="#FF1A3333"
                                CornerRadius="6,6,0,0"
                                Padding="12,10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding ValdButik2.ButiksNamn}" 
                                               FontSize="15" 
                                               FontWeight="Bold"
                                               Foreground="White"/>
                                    <TextBlock Text="{Binding ValdButik2.Adress}" 
                                               FontSize="11" 
                                               Foreground="#B0C4C4"
                                               Margin="0,2,0,0"/>
                                </StackPanel>
                                <Border Grid.Column="1"
                                        Background="#4D81C784"
                                        CornerRadius="3"
                                        Padding="8,4"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Butik2Böcker.Count, StringFormat={}{0} böcker}" 
                                               FontSize="11" 
                                               FontWeight="SemiBold"
                                               Foreground="White"/>
                                </Border>
                            </Grid>
                        </Border>
                        <!-- Butik 2 ListBox -->
                        <ListBox ItemsSource="{Binding Butik2Böcker}"
                                 ItemTemplate="{StaticResource LagerSaldoTemplate}"
                                 ItemContainerStyle="{StaticResource BookItemStyle}"
                                 dd:DragDrop.IsDragSource="True"
                                 dd:DragDrop.IsDropTarget="True"
                                 dd:DragDrop.DropHandler="{Binding DropHandler}"
                                 dd:DragDrop.UseDefaultDragAdorner="True"
                                 dd:DragDrop.DefaultDragAdornerOpacity="0.8"
                                 BorderThickness="0"
                                 Background="White"
                                 SelectedItem="{Binding ValdBok}"
                                 Tag="Butik2"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 ScrollViewer.CanContentScroll="False"/>
                    </DockPanel>
                </Border>
            </Grid>

            <!-- Papperskorg -->
            <Border Grid.Row="2"
                    x:Name="TrashBorder"
                    Margin="0,15,0,15"
                    Background="#FFE57373"
                    BorderBrush="#D32F2F"
                    BorderThickness="2"
                    CornerRadius="8"
                    Padding="15,12"
                    HorizontalAlignment="Center"
                    AllowDrop="True"
                    dd:DragDrop.IsDropTarget="True"
                    dd:DragDrop.DropHandler="{Binding DropHandler}">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" 
                                    ShadowDepth="4" 
                                    Opacity="0.4"/>
                </Border.Effect>
                <Border.Style>
                    <Style TargetType="Border">
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FFD32F2F"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🗑️" 
                               FontSize="32" 
                               VerticalAlignment="Center"
                               Margin="0,0,12,0"/>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="Dra hit för att ta bort bok" 
                                   FontSize="14" 
                                   FontWeight="Bold"
                                   Foreground="White"/>
                        <TextBlock Text="(Tar bort från vald butik)" 
                                   FontSize="11" 
                                   Foreground="White"
                                   FontStyle="Italic"
                                   Margin="0,2,0,0"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Statusmeddelande -->
            <Border Grid.Row="3"
                    Margin="0,0,0,15"
                    Background="White"
                    BorderBrush="#DDDDDD"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="12"
                    MinHeight="45">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="4" 
                                    ShadowDepth="2" 
                                    Opacity="0.2"/>
                </Border.Effect>
                <TextBlock Text="{Binding StatusMeddelande}"
                           FontSize="13"
                           Foreground="{Binding StatusTextFärg}"
                           FontWeight="SemiBold"
                           TextWrapping="Wrap"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
            </Border>

            <!-- Footer -->
            <Grid Grid.Row="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Tillbaka knapp -->
                <Button Grid.Column="0"
                        Content="← Tillbaka" 
                        Command="{Binding CancelCommand}"
                        IsCancel="True"
                        Padding="18,9"
                        Background="#FFE57373"
                        Foreground="White"
                        BorderBrush="#D32F2F"
                        BorderThickness="2"
                        Style="{StaticResource ModernButton}"/>

                <!-- Höger knappar -->
                <StackPanel Grid.Column="2" 
                            Orientation="Horizontal">
                    <Button Content="↶ Återställ" 
                            Command="{Binding ÅterställCommand}"
                            Padding="18,9" 
                            Margin="0,0,10,0"
                            Background="#FFBDBDBD"
                            Foreground="White"
                            BorderBrush="#757575"
                            BorderThickness="2"
                            Style="{StaticResource ModernButton}"/>
                    <Button Content="💾 Spara Ändringar" 
                            Command="{Binding SparaÄndringarCommand}"
                            Padding="18,9"
                            Background="#FF81C784"
                            Foreground="White"
                            BorderBrush="#388E3C"
                            BorderThickness="2"
                            Style="{StaticResource ModernButton}"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</Window>