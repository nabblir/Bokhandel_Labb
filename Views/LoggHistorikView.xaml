<Window x:Class="Bokhandel_Labb.Views.LoggHistorikView"
         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
         xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
         xmlns:local="clr-namespace:Bokhandel_Labb.Views"
         xmlns:commands="clr-namespace:Bokhandel_Labb.Commands"
         mc:Ignorable="d"
         FontFamily="Bahnschrift SemiLight"
         Title="Inspektera loggar"
         SizeToContent="Height"
         MinHeight="700"
         MaxHeight="1050"
         Width="900"
         MaxWidth="1200"
         WindowStartupLocation="CenterOwner"
         Background="#FF2F4F4F"
         ResizeMode="NoResize">
    <!-- Commands för kortkommandon -->
    <Window.InputBindings>
        <KeyBinding Key="Q" Modifiers="Alt" Command="{Binding CancelCommand}"/>
    </Window.InputBindings>

    <!-- Styles för kontroller -->
    <Window.Resources>
        <commands:LoggTextConverter x:Key="LoggTextConverter"/>
        <!-- Style för Menu -->
        <Style TargetType="Menu">
            <Setter Property="Background" Value="#FF1A3333"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- Style för MenuItem -->
        <Style TargetType="MenuItem">
            <Setter Property="Background" Value="#FF1A3333"/>
            <Setter Property="Foreground" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="#FF0D1F1F"/>
                </Trigger>
                <Trigger Property="IsSubmenuOpen" Value="True">
                    <Setter Property="Background" Value="#FF0D1F1F"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style för böcker -->
        <Style x:Key="BookItemStyle" TargetType="{x:Type ListBoxItem}">
            <Setter Property="Margin" Value="2,1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E3F2FD"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#BBDEFB"/>
                    <Setter Property="BorderBrush" Value="#2196F3"/>
                    <Setter Property="BorderThickness" Value="2,0,2,1"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- DataTemplate för böcker -->
        <DataTemplate x:Key="LagerSaldoTemplate">
            <Border Background="#F5F5F5" 
                    CornerRadius="3" 
                    Padding="8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="{Binding LoggTextConverter.Händelse, ConverterParameter='MaxLength=25'}"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="{Binding LoggID}" 
                                   FontWeight="SemiBold" 
                                   FontSize="13"
                                   Foreground="#1A237E"
                                   TextTrimming="CharacterEllipsis"/>
                        <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                            <TextBlock Text="{Binding User}" 
                                       FontSize="11" 
                                       Foreground="#424242"
                                       TextTrimming="CharacterEllipsis"
                                       MaxWidth="200"/>
                            <TextBlock Text=" • " 
                                       FontSize="11" 
                                       Foreground="#9E9E9E"
                                       Margin="3,0"/>
                            <TextBlock Text="{Binding Datum}" 
                                       FontSize="10" 
                                       Foreground="#757575"/>
                        </StackPanel>
                    </StackPanel>

                    <Border Grid.Column="1"
                            Background="#E8F5E9"
                            CornerRadius="3"
                            Padding="10,5"
                            Margin="15,0,0,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Left"
                            MaxWidth="500">
                        <TextBlock FontSize="11"
                                    FontWeight="Bold"
                                    Foreground="#2E7D32"
                                    TextWrapping="Wrap"
                                    TextTrimming="CharacterEllipsis">
                            <TextBlock.Text>
                                <MultiBinding Converter="{StaticResource LoggTextConverter}">
                                    <Binding Path="LogTyp"/>
                                    <Binding Path="Händelse"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </Border>
                </Grid>
            </Border>
        </DataTemplate>

        <!-- Button Style med IsPressed feedback -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="ButtonBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="5"
                                Padding="{TemplateBinding Padding}">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="5" 
                                                ShadowDepth="2" 
                                                Opacity="0.3"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="ButtonBorder" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="ButtonBorder" Property="RenderTransformOrigin" Value="0.5,0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <!-- Header -->
        <Border Background="#FF1A3333" 
                Height="70" 
                VerticalAlignment="Top"
                Margin="0,0,0,0"
                Panel.ZIndex="1">
            <Grid Margin="20,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Titel -->
                <TextBlock Grid.Column="0"
                           Text="🔍 Loggkollen" 
                           FontSize="26" 
                           FontWeight="Bold"
                           Foreground="White"
                           VerticalAlignment="Center"/>

                <!-- Sökruta -->
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Margin="20,70,20,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Butik Val -->
            <Grid Grid.Row="0" Margin="0,5,0,5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Vänster butik -->
                <Border Grid.Column="0"
                        Background="#FF3A5A5A"
                        CornerRadius="6"
                        Padding="12">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="6" 
                                        ShadowDepth="2" 
                                        Opacity="0.3"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="📍 Välj butik" 
                                   FontWeight="SemiBold" 
                                   FontSize="13"
                                   Margin="0,0,0,6" 
                                   Foreground="White"/>
                        <ComboBox ItemsSource="{Binding TillgängligaButiker1}"
                                  SelectedItem="{Binding ValdButik1}"
                                  DisplayMemberPath="ButiksNamn"
                                  Padding="8"
                                  FontSize="12"
                                  Background="White"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Butiker och böcker -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Butik 1 Lager -->
                <Border Grid.Column="0" 
                        Background="#FF3A5A5A"
                        BorderBrush="#FF5A7A7A" 
                        BorderThickness="1" 
                        CornerRadius="6"
                        Padding="0">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="8" 
                                        ShadowDepth="3" 
                                        Opacity="0.3"/>
                    </Border.Effect>
                    <DockPanel  Margin="0,0,0,15">
                        <!-- Header -->
                        <Border DockPanel.Dock="Top" 
                                Background="#FF1A3333"
                                CornerRadius="6,6,0,0"
                                Padding="12,10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding ValdButik1.ButiksNamn}" 
                                               FontSize="15" 
                                               FontWeight="Bold"
                                               Foreground="White"/>
                                    <TextBlock Text="{Binding ValdButik1.Adress}" 
                                               FontSize="11" 
                                               Foreground="#B0C4C4"
                                               Margin="0,2,0,0"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Butik 1 ListBox -->
                        <ListBox ItemsSource="{Binding AllaLoggar}"
                                 ItemTemplate="{StaticResource LagerSaldoTemplate}"
                                 ItemContainerStyle="{StaticResource BookItemStyle}"
                                 BorderThickness="0"
                                 Background="White"
                                 SelectedItem="{Binding ValdLogg}"
                                 Tag="Butik1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 ScrollViewer.CanContentScroll="False" d:ItemsSource="{d:SampleData ItemCount=5}"/>

                    </DockPanel>
                </Border>
            </Grid>

            <!-- Statusmeddelande -->
            <Border Grid.Row="3"
                    Margin="0,5,0,15"
                    Background="White"
                    BorderBrush="#DDDDDD"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="12"
                    MinHeight="45">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="4" 
                                    ShadowDepth="2" 
                                    Opacity="0.2"/>
                </Border.Effect>
                <TextBlock Text="{Binding StatusMeddelande}"
                           FontSize="13"
                           Foreground="{Binding StatusTextFärg}"
                           FontWeight="SemiBold"
                           TextWrapping="Wrap"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
            </Border>

            <!-- Footer -->
            <Grid Grid.Row="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Tillbaka knapp -->
                <Button Grid.Column="0"
                        Content="← Tillbaka" 
                        Command="{Binding CancelCommand}"
                        IsCancel="True"
                        Padding="18,9"
                        Background="#FFE57373"
                        Foreground="White"
                        BorderBrush="#D32F2F"
                        BorderThickness="2"
                        Style="{StaticResource ModernButton}"/>

                <!-- Höger knappar -->
                <StackPanel Grid.Column="2" 
                            Orientation="Horizontal"/>
            </Grid>
        </Grid>
    </Grid>
</Window>
